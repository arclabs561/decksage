#!/usr/bin/env python3 """ Monitor Dataset Expansion Progress Track growth in real-time as scraping proceeds. """ import subprocess import time from pathlib import Path def count_decks(source): """Count .zst files for a source.""" base = Path("../../src/backend/data-full/games/magic") source_path = ( base / source / "collections" if (base / source / "collections").exists() else base / source ) if not source_path.exists(): return 0 result = subprocess.run( ["find", str(source_path), "-name", "*.zst"], check=False, capture_output=True, text=True ) return len([l for l in result.stdout.split("\n") if l.strip()]) def monitor_loop(): """Monitor expansion progress.""" print("EXPANSION MONITORING") print("=" * 60) print("Tracking scraping progress across all sources") print("Press Ctrl+C to stop monitoring") print() sources = {"mtgtop8": count_decks("mtgtop8"), "goldfish": count_decks("goldfish")} print(f"{'Source':<15} {'Start':>8} {'Current':>10} {'Growth':>10} {'Rate':>10}") print("-" * 60) start_time = time.time() try: while True: current = {} for source in sources: current[source] = count_decks(source) elapsed = time.time() - start_time for source in sources: start_count = sources[source] curr_count = current[source] growth = curr_count - start_count rate = growth / (elapsed / 60) if elapsed > 0 else 0 print( f"{source:<15} {start_count:>8,} {curr_count:>10,} {growth:>+10,} {rate:>9.1f}/min" ) total_start = sum(sources.values()) total_current = sum(current.values()) total_growth = total_current - total_start total_rate = total_growth / (elapsed / 60) if elapsed > 0 else 0 print( f"{'TOTAL':<15} {total_start:>8,} {total_current:>10,} {total_growth:>+10,} {total_rate:>9.1f}/min" ) print( f"\nElapsed: {elapsed / 60:.1f} minutes | Target: 50,000 decks | ETA: {(50000 - total_current) / total_rate:.0f} min" if total_rate > 0 else "" ) print("\033[F" * 7, end="") # Move cursor up to overwrite time.sleep(10) except KeyboardInterrupt: print("\n\n Monitoring stopped") print("\nFinal counts:") for source in sources: curr = count_decks(source) print(f" {source}: {curr:,} decks (+{curr - sources[source]:,})") if __name__ == "__main__": monitor_loop()
