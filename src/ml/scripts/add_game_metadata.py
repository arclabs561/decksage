#!/usr/bin/env python3 # /// script # requires-python = ">=3.11" # /// """ Add explicit game metadata to test sets. Ensures all test sets have explicit "game" field in metadata. """ import argparse import json import logging from pathlib import Path from ..utils.logging_config import setup_script_logging logger = setup_script_logging() def add_game_metadata(test_set_path: Path, output_path: Path, game: str) -> None: """Add explicit game metadata to test set.""" logger.info(f"Loading test set from {test_set_path}") with open(test_set_path) as f: data = json.load(f) # Ensure data has proper structure if "queries" not in data: # Assume flat structure, wrap it data = {"version": data.get("version", "unknown"), "game": game, "queries": data} else: # Add game field to metadata data["game"] = game # Validate game value if game not in ["magic", "pokemon", "yugioh"]: logger.error(f"Invalid game: {game}. Must be one of: magic, pokemon, yugioh") return # Save output_path.parent.mkdir(parents=True, exist_ok=True) with open(output_path, "w") as f: json.dump(data, f, indent=2) logger.info(f" Added game metadata: {game}") logger.info(f" Saved to {output_path}") def main() -> int: """Add game metadata to test sets.""" parser = argparse.ArgumentParser(description="Add game metadata to test sets") parser.add_argument("--input", type=str, required=True, help="Input test set JSON") parser.add_argument("--output", type=str, help="Output test set JSON (default: overwrite input)") parser.add_argument("--game", type=str, required=True, choices=["magic", "pokemon", "yugioh"], help="Game name") args = parser.parse_args() input_path = Path(args.input) output_path = Path(args.output) if args.output else input_path if not input_path.exists(): logger.error(f"Input not found: {input_path}") return 1 add_game_metadata(input_path, output_path, args.game) return 0 if __name__ == "__main__": import sys sys.exit(main())