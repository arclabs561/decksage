#!/usr/bin/env python3 # /// script # requires-python = ">=3.11" # dependencies = [ # "gensim>=4.3.0", # ] # /// """Generate Magic test decks from cards in embeddings.""" import json import random from pathlib import Path try: from gensim.models import KeyedVectors HAS_DEPS = True except ImportError: HAS_DEPS = False def generate_magic_test_decks( embeddings_path: Path, output_path: Path, num_decks: int = 5, deck_size: int = 40, ) -> None: """Generate Magic test decks from cards in embeddings.""" if not HAS_DEPS: print("Missing gensim") return print(f"Loading embeddings from {embeddings_path}...") kv = KeyedVectors.load(str(embeddings_path)) all_cards = list(kv.key_to_index.keys()) print(f"Loaded {len(all_cards)} cards") # Filter out basic lands (too common) basic_lands = {"Forest", "Swamp", "Plains", "Mountain", "Island"} playable_cards = [c for c in all_cards if c not in basic_lands] print(f"Using {len(playable_cards)} playable cards (excluding basic lands)") test_decks = [] for i in range(num_decks): # Sample random cards for deck deck_cards = random.sample(playable_cards, min(deck_size, len(playable_cards))) # Create deck in cards format (with partition field) deck = { "deck_id": f"test_magic_deck_{i+1}", "game": "magic", "format": "Modern", "source": "synthetic_test", "cards": [ { "name": card, "count": 1, "partition": "Main" } for card in deck_cards ] } test_decks.append(deck) # Save output_path.parent.mkdir(parents=True, exist_ok=True) with open(output_path, "w") as f: for deck in test_decks: f.write(json.dumps(deck) + "\n") print(f" Generated {len(test_decks)} Magic test decks -> {output_path}") if __name__ == "__main__": import sys from pathlib import Path from ml.utils.paths import PATHS embeddings_path = PATHS.embeddings / "magic_128d_test_pecanpy.wv" output_path = PATHS.experiments / "downstream_test_data" / "magic_refinement_test_decks.jsonl" if len(sys.argv) > 1: embeddings_path = Path(sys.argv[1]) if len(sys.argv) > 2: output_path = Path(sys.argv[2]) generate_magic_test_decks(embeddings_path, output_path, num_decks=5, deck_size=40)