# @arclabs561/ai-visual-test

AI-powered visual testing. Uses vision language models to understand screenshots instead of pixel-diffing.

## Why

Pixel-based testing breaks when content changes or layouts shift. This tool asks "does this look correct?" instead of "did pixels change?"

## Install

```bash
npm install @arclabs561/ai-visual-test
```

Set an API key:

```bash
# .env file
GEMINI_API_KEY=your-key-here
# or
OPENAI_API_KEY=your-key-here
# or
ANTHROPIC_API_KEY=your-key-here
```

## Use

```javascript
import { validateScreenshot } from '@arclabs561/ai-visual-test';

const result = await validateScreenshot(
  'screenshot.png',
  'Check if this payment form is accessible and usable'
);

console.log(result.score); // 0-10
console.log(result.issues); // ['Missing error messages', 'Low contrast']
```

## What it's good for

- **Accessibility** - Fast programmatic checks or VLLM semantic evaluation
- **Design principles** - Validates brutalist, minimal, or other styles
- **Temporal testing** - Analyzes animations and gameplay over time
- **State validation** - Fast programmatic or VLLM extraction
- **Game testing** - Validate gameplay with variable goals
- **Natural language specs** - Write tests in plain English

## What it's not good for

- Pixel-perfect layout testing (use pixel-diffing tools)
- Exact color matching (use design tools)
- Performance testing (use Lighthouse)
- Unit testing (use Jest/Vitest)

## API

### Core

```javascript
import { validateScreenshot, createConfig } from '@arclabs561/ai-visual-test';

// Configure (optional - auto-detects from env)
const config = createConfig({
  provider: 'gemini',
  apiKey: process.env.GEMINI_API_KEY
});

// Validate
const result = await validateScreenshot(
  'screenshot.png',
  'Evaluate this screenshot',
  { testType: 'payment-screen' }
);
```

### Sub-modules (better tree-shaking)

```javascript
// Validators
import { StateValidator } from '@arclabs561/ai-visual-test/validators';

// Temporal
import { aggregateTemporalNotes } from '@arclabs561/ai-visual-test/temporal';

// Multi-modal
import { multiModalValidation } from '@arclabs561/ai-visual-test/multi-modal';

// Ensemble
import { EnsembleJudge } from '@arclabs561/ai-visual-test/ensemble';

// Persona
import { experiencePageAsPersona } from '@arclabs561/ai-visual-test/persona';

// Specs
import { parseSpec } from '@arclabs561/ai-visual-test/specs';

// Utils
import { getCacheStats } from '@arclabs561/ai-visual-test/utils';
```

### With Playwright

```javascript
import { test } from '@playwright/test';
import { validateScreenshot } from '@arclabs561/ai-visual-test';

test('payment screen', async ({ page }) => {
  await page.goto('https://example.com/checkout');
  await page.screenshot({ path: 'checkout.png' });
  
  const result = await validateScreenshot(
    'checkout.png',
    'Check if payment form is accessible'
  );
  
  assert(result.score >= 8, 'Payment form should score at least 8');
});
```

## Features

- **Multi-provider** - Gemini, OpenAI, Claude
- **Cost-effective** - Auto-selects cheapest provider, includes caching
- **Multi-modal** - Screenshots + rendered code + context
- **Temporal** - Time-series validation for animations
- **Multi-perspective** - Multiple personas evaluate same state
- **Zero dependencies** - Pure ES Modules

## Examples

See `examples/` directory for complete examples.

## Documentation

- `docs/API_SUBMODULES.md` - Sub-module usage
- `docs/API_SURFACE_ORGANIZATION.md` - API organization
- `CHANGELOG.md` - Version history

## License

MIT
