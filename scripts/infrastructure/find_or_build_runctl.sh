#!/usr/bin/env bash
# Find or build runctl binary
# Sets RUNCTL_BIN variable and returns 0 if found/built, 1 if failed
# Can be sourced or executed directly

set -euo pipefail if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then # Being sourced SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" else # Being executed SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)" fi PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)" # Default path RUNCTL_BIN="${RUNCTL_BIN:-$PROJECT_ROOT/../runctl/target/release/runctl}" # If already exists, use it if [[ -f "$RUNCTL_BIN" ]]; then export RUNCTL_BIN return 0 2>/dev/null || exit 0 fi # Try to build from local project if [[ -d "$PROJECT_ROOT/../runctl" ]]; then echo "Warning: runctl not found, building from local project..." if (cd "$PROJECT_ROOT/../runctl" && cargo build --release 2>&1); then if [[ -f "$RUNCTL_BIN" ]]; then echo " Built runctl successfully" export RUNCTL_BIN return 0 2>/dev/null || exit 0 fi fi echo "Warning: Local build failed, trying cargo install..." fi # Fallback to cargo install if command -v cargo &> /dev/null; then echo "ðŸ“¦ Trying to install runctl via cargo..." if cargo install runctl 2>&1; then if command -v runctl &> /dev/null; then RUNCTL_BIN="runctl" echo " Installed runctl via cargo" export RUNCTL_BIN return 0 2>/dev/null || exit 0 fi fi fi # Failed echo "Error: Could not find or build runctl" echo " Options:" echo " 1. Build manually: cd ../runctl && cargo build --release" echo " 2. Install via cargo: cargo install runctl (if available on crates.io)" exit 1
