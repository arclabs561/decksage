#!/bin/bash # Setup EBS volume for training data (one-time setup) # Pre-warms volume with data from S3 for faster training set -euo pipefail SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)" RUNCTL_BIN="${RUNCTL_BIN:-$PROJECT_ROOT/../runctl/target/release/runctl}" VOLUME_ID="${1:-}" INSTANCE_ID="${2:-}" S3_SOURCE="${S3_SOURCE:-s3://games-collections/processed/}" MOUNT_POINT="${MOUNT_POINT:-/mnt/data}" if [[ -z "$VOLUME_ID" ]]; then echo "Usage: $0 <volume-id> [instance-id] [s3-source]" echo "" echo "Examples:" echo " # Pre-warm volume on existing instance" echo " $0 vol-xxx i-xxx s3://games-collections/processed/" echo "" echo " # Create new instance for pre-warming" echo " $0 vol-xxx '' s3://games-collections/processed/" echo "" exit 1 fi echo "======================================================================" echo "EBS VOLUME PRE-WARMING" echo "======================================================================" echo "Volume: $VOLUME_ID" echo "Instance: ${INSTANCE_ID:-will create temporary}" echo "S3 Source: $S3_SOURCE" echo "Mount Point: $MOUNT_POINT" echo "" # Check if volume exists if ! "$RUNCTL_BIN" aws ebs list 2>&1 | grep -q "$VOLUME_ID"; then echo "Error: Volume $VOLUME_ID not found" exit 1 fi # Pre-warm the volume echo "Pre-warming volume from S3..." "$RUNCTL_BIN" aws ebs pre-warm \ "$VOLUME_ID" \ "$S3_SOURCE" \ --mount-point "$MOUNT_POINT" \ ${INSTANCE_ID:+--instance-id "$INSTANCE_ID"} echo "" echo " Volume pre-warming complete!" echo " Volume $VOLUME_ID is now ready for fast training" echo " Attach to instances with: runctl aws ebs attach $VOLUME_ID --instance-id <instance-id>"