#!/usr/bin/env bash # Run all training steps in parallel via runctl on AWS (creates separate instances for each) set -euo pipefail SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)" RUNCTL="${PROJECT_ROOT}/../runctl/target/release/runctl" OUTPUT_VERSION="${OUTPUT_VERSION:-v2024-W01}" echo "==========================================" echo "Running All Training Steps (Parallel)" echo "==========================================" echo "Output version: $OUTPUT_VERSION" echo "" echo "This will create 3 separate AWS instances:" echo " 1. Fine-tuning instruction embeddings (g5.xlarge)" echo " 2. Training co-occurrence with graph (g5.2xlarge)" echo " 3. Training full hybrid system (g5.2xlarge)" echo "" read -p "Continue? (y/N) " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then exit 1 fi # Step 1: Fine-tune instruction embeddings (in background) echo "" echo "==========================================" echo "Step 1: Fine-tuning instruction embeddings" echo "==========================================" export OUTPUT_VERSION="$OUTPUT_VERSION" bash "$SCRIPT_DIR/train_instruction_finetune_runctl.sh" & STEP1_PID=$! echo "Started fine-tuning (PID: $STEP1_PID)" # Step 2: Train co-occurrence with graph (in background) echo "" echo "==========================================" echo "Step 2: Training co-occurrence embeddings with graph" echo "==========================================" bash "$SCRIPT_DIR/train_with_graph_runctl.sh" & STEP2_PID=$! echo "Started co-occurrence training (PID: $STEP2_PID)" # Step 3: Train full hybrid (including GNN) (in background) echo "" echo "==========================================" echo "Step 3: Training full hybrid system (co-occurrence + GNN)" echo "==========================================" SKIP_GNN=false bash "$SCRIPT_DIR/train_hybrid_full_runctl.sh" & STEP3_PID=$! echo "Started hybrid training (PID: $STEP3_PID)" echo "" echo " All training jobs submitted in parallel!" echo "" echo "Monitor with:" echo " $RUNCTL aws monitor" echo "" echo "Or check individual instances:" echo " $RUNCTL aws status <instance-id>"