#!/usr/bin/env python3 """Training script to run on EC2 instance.""" from pecanpy.pecanpy import SparseOTF from gensim.models import Word2Vec import pandas as pd import subprocess import sys DIM = 128 OUTPUT_NAME = "magic_128d_test" # Prepare edgelist print("Loading pairs CSV...") df = pd.read_csv('pairs_large.csv') print(f"Loaded {len(df)} pairs") print("Creating graph edgelist...") with open('graph.edg', 'w') as f: for _, row in df.iterrows(): f.write(f"{row['NAME_1']}\t{row['NAME_2']}\t{row['COUNT_MULTISET']}\n") print("Training embeddings...") # Train g = SparseOTF(p=1.0, q=1.0, workers=4, verbose=True, extend=True) g.read_edg('graph.edg', weighted=True, directed=False) walks = g.simulate_walks(num_walks=10, walk_length=80) model = Word2Vec(walks, vector_size=DIM, window=10, min_count=0, sg=1, workers=4, epochs=1) model.wv.save('embeddings.wv') print("Training complete!") # Upload to S3 print("Uploading to S3...") result = subprocess.run(['aws', 's3', 'cp', 'embeddings.wv', f's3://games-collections/embeddings/{OUTPUT_NAME}_pecanpy.wv']) if result.returncode == 0: print(" Upload successful!") sys.exit(0) else: print(f"Error: Upload failed: {result.returncode}") sys.exit(1)
