#!/bin/bash # Train embeddings using runctl on AWS # Usage: ./scripts/train_with_runctl.sh <instance-id> <game> [epochs] # game: pokemon, yugioh, or multigame # epochs: default 50 set -euo pipefail SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)" RUNCTL_BIN="${RUNCTL_BIN:-$PROJECT_ROOT/../runctl/target/release/runctl}" if [ $# -lt 2 ]; then echo "Usage: $0 <instance-id> <game> [epochs]" echo "" echo "Examples:" echo " $0 i-1234567890abcdef0 pokemon 50" echo " $0 i-1234567890abcdef0 yugioh 50" echo " $0 i-1234567890abcdef0 multigame 50" echo "" echo "Available instances:" aws ec2 describe-instances --filters "Name=instance-state-name,Values=running" \ --query "Reservations[*].Instances[*].[Tags[?Key=='Name'].Value|[0],InstanceType,InstanceId]" \ --output table 2>/dev/null || echo " (No running instances found)" exit 1 fi INSTANCE_ID="$1" GAME="$2" EPOCHS="${3:-50}" if [ ! -f "$RUNCTL_BIN" ]; then echo "Error: runctl not found at $RUNCTL_BIN" echo " Build it with: cd ../runctl && cargo build --release" exit 1 fi echo " Training $GAME embeddings on AWS instance $INSTANCE_ID" echo " Epochs: $EPOCHS" echo "" case "$GAME" in pokemon|yugioh) echo "Training $GAME game-specific embeddings..." "$RUNCTL_BIN" aws train "$INSTANCE_ID" \ src/ml/scripts/train_game_specific_embeddings.py \ --output-s3 s3://games-collections/embeddings/ \ -- \ --input s3://games-collections/processed/pairs_multi_game.csv \ --output "${GAME}_game_specific.wv" \ --game "$GAME" \ --dim 128 \ --epochs "$EPOCHS" ;; multigame) echo "Training multi-game unified embeddings..." "$RUNCTL_BIN" aws train "$INSTANCE_ID" \ src/ml/scripts/train_multi_game_embeddings.py \ --output-s3 s3://games-collections/embeddings/ \ -- \ --input s3://games-collections/processed/pairs_multi_game.csv \ --output multi_game_unified.wv \ --dim 128 \ --epochs "$EPOCHS" ;; *) echo "Error: Unknown game: $GAME" echo " Valid options: pokemon, yugioh, multigame" exit 1 ;; esac echo "" echo " Training started on $INSTANCE_ID" echo " Monitor with: $RUNCTL_BIN aws monitor $INSTANCE_ID --follow" echo " Output will be in: s3://games-collections/embeddings/"
