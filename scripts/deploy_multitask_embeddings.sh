#!/usr/bin/env bash # Deploy multi-task embeddings to production set -euo pipefail SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)" cd "$PROJECT_ROOT" # Configuration # Accept source model as first argument, or use default SOURCE_MODEL="${1:-data/embeddings/multitask_sub5.wv}" PROD_MODEL="data/embeddings/production.wv" BACKUP_DIR="data/embeddings/backups" TIMESTAMP=$(date +%Y%m%d_%H%M%S) echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" echo "â•‘ MULTI-TASK EMBEDDING DEPLOYMENT â•‘" echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" echo "" # Check source model exists if [[ ! -f "$SOURCE_MODEL" ]]; then echo "Error: Error: Source model not found: $SOURCE_MODEL" echo " Run: just train-multitask" exit 1 fi echo " Source model found: $SOURCE_MODEL" echo " Size: $(du -h "$SOURCE_MODEL" | cut -f1)" echo "" # Create backup directory mkdir -p "$BACKUP_DIR" # Backup existing production model if it exists if [[ -f "$PROD_MODEL" ]]; then BACKUP_FILE="$BACKUP_DIR/production_${TIMESTAMP}.wv" echo "ğŸ“¦ Backing up existing production model..." cp "$PROD_MODEL" "$BACKUP_FILE" echo " Backup saved to: $BACKUP_FILE" echo "" fi # Validate source model echo "ğŸ” Validating source model..." if ! uv run python3 -c " from gensim.models import KeyedVectors import sys try: wv = KeyedVectors.load('$SOURCE_MODEL') print(f' Vocabulary: {len(wv)} cards') print(f' Dimension: {wv.vector_size}') # Test similarity if len(wv) > 0: test_card = list(wv.index_to_key)[0] similar = wv.most_similar(test_card, topn=1) print(f' Test query: {test_card} â†’ {similar[0][0]} (score: {similar[0][1]:.4f})') print(' Model validation passed') except Exception as e: print(f' Error: Model validation failed: {e}') sys.exit(1) "; then echo "Error: Model validation failed" exit 1 fi echo "" # Deploy echo " Deploying multi-task embeddings..." cp "$SOURCE_MODEL" "$PROD_MODEL" echo " Deployed to: $PROD_MODEL" echo "" # Verify deployment if [[ -f "$PROD_MODEL" ]]; then PROD_SIZE=$(du -h "$PROD_MODEL" | cut -f1) echo " Deployment successful" echo " Production model: $PROD_MODEL" echo " Size: $PROD_SIZE" echo "" # Show model info echo " Model Information:" FILE_SIZE=$(stat -f%z "$PROD_MODEL" 2>/dev/null || stat -c%s "$PROD_MODEL" 2>/dev/null) FILE_SIZE_MB=$(echo "scale=1; $FILE_SIZE / 1024 / 1024" | bc) uv run python3 -c " from gensim.models import KeyedVectors wv = KeyedVectors.load('$PROD_MODEL') print(f' Vocabulary: {len(wv)} cards') print(f' Dimension: {wv.vector_size}') print(f' File size: ${FILE_SIZE_MB} MB') " echo "" echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" echo "â•‘ DEPLOYMENT COMPLETE â•‘" echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" echo "" echo " Multi-task embeddings deployed successfully" echo "" echo "ğŸ“‹ Next Steps:" echo " 1. Update application configuration if needed" echo " 2. Monitor performance metrics" echo " 3. Collect user feedback" echo " 4. Review logs for any issues" echo "" echo " Expected Performance:" echo " - Co-occurrence P@10: ~0.21" echo " - Functional P@10: ~0.09" echo " - Substitution P@10: ~0.22" echo "" else echo "Error: Deployment failed: Production model not found" exit 1 fi