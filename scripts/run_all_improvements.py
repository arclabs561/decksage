#!/usr/bin/env python3 # /// script # requires-python = ">=3.11" # dependencies = [] # /// """ Comprehensive Implementation Orchestrator. Runs all improvements in the correct order: 1. Fix Yu-Gi-Oh card names 2. Integrate oracle text similarity 3. Integrate functional tags 4. Train enhanced embeddings 5. Evaluate improvements """ from __future__ import annotations import argparse import subprocess import sys from pathlib import Path from typing import Any def run_step(description: str, cmd: list[str]) -> bool: """Run a single implementation step.""" print("=" * 70) print(description) print("=" * 70) print(f"Running: {' '.join(cmd)}") result = subprocess.run(cmd, capture_output=True, text=True) if result.returncode == 0: print(" Success") if result.stdout: print(result.stdout[-500:]) # Last 500 chars return True else: print("Error: Failed") if result.stderr: print(result.stderr[-500:]) return False def main() -> int: parser = argparse.ArgumentParser(description="Run all improvements") parser.add_argument("--skip-yugioh-fix", action="store_true", help="Skip Yu-Gi-Oh name fix") parser.add_argument("--skip-text", action="store_true", help="Skip oracle text integration") parser.add_argument("--skip-functional", action="store_true", help="Skip functional tags") parser.add_argument("--skip-training", action="store_true", help="Skip training") parser.add_argument("--pairs", type=Path, default=Path("data/processed/pairs_large.csv"), help="Pairs CSV") parser.add_argument("--card-attrs", type=Path, default=Path("data/processed/card_attributes_enriched.csv"), help="Card attributes CSV") parser.add_argument("--decks", type=Path, default=Path("data/processed/decks_all_final.jsonl"), help="Decks JSONL") args = parser.parse_args() print("=" * 70) print("COMPREHENSIVE IMPLEMENTATION: ALL IMPROVEMENTS") print("=" * 70) print() steps_completed = 0 steps_failed = 0 # Step 1: Fix Yu-Gi-Oh card names if not args.skip_yugioh_fix: # This would require card database access print("Step 1: Yu-Gi-Oh card name fix (requires card database)") print(" Warning: Skipping - requires card database setup") # Step 2: Integrate oracle text if not args.skip_text and args.card_attrs.exists(): success = run_step( "Step 2: Integrating Oracle Text Similarity", [ sys.executable, "src/ml/scripts/integrate_oracle_text_training.py", "--card-attrs", str(args.card_attrs), "--pairs", str(args.pairs), "--output", "data/processed/pairs_with_text.csv", ] ) if success: steps_completed += 1 args.pairs = Path("data/processed/pairs_with_text.csv") # Use enhanced pairs else: steps_failed += 1 # Step 3: Integrate functional tags if not args.skip_functional and args.card_attrs.exists(): success = run_step( "Step 3: Integrating Functional Tags", [ sys.executable, "src/ml/scripts/integrate_functional_tags_training.py", "--card-attrs", str(args.card_attrs), "--pairs", str(args.pairs), "--output", "data/processed/pairs_with_functional.csv", ] ) if success: steps_completed += 1 args.pairs = Path("data/processed/pairs_with_functional.csv") # Use enhanced pairs else: steps_failed += 1 # Step 4: Train enhanced embeddings if not args.skip_training and args.pairs.exists() and args.decks.exists(): success = run_step( "Step 4: Training Enhanced Embeddings", [ sys.executable, "src/ml/scripts/train_multitask_refined_enhanced.py", "--pairs", str(args.pairs), "--decks", str(args.decks), "--output", "data/embeddings/multitask_enhanced.wv", "--formats", "Modern", "Legacy", "Standard", "--max-placement", "32", "--temporal-decay-days", "365", ] ) if success: steps_completed += 1 else: steps_failed += 1 # Summary print() print("=" * 70) print("IMPLEMENTATION SUMMARY") print("=" * 70) print(f"Steps completed: {steps_completed}") print(f"Steps failed: {steps_failed}") print() if steps_failed == 0: print(" All steps completed successfully!") return 0 else: print("Warning: Some steps failed - check output above") return 1 if __name__ == "__main__": exit(main())
