# Fly.io configuration for DeckSage API (Private Tailscale Network)
# See: https://fly.io/docs/reference/configuration/
# This app is configured for private access via Tailscale only

app = "decksage"
primary_region = "iad"  # US East (Virginia) - adjust to your preference

[build]
  dockerfile = "Dockerfile.api"

[env]
  PORT = "8000"
  PYTHONUNBUFFERED = "1"

# Private networking only - no public HTTP service
# Access via Tailscale private network (6PN) or Tailscale router
# To access:
#   1. Set up Tailscale router (see docs/DEPLOYMENT.md)
#   2. Or connect app directly to Tailscale (requires tailscaled in Dockerfile)
#   3. Access via private IPv6: fdaa:3:<org>:<app>::2:8000

# Internal service (private network only)
[[services]]
  internal_port = 8000
  protocol = "tcp"
  processes = ["app"]

  [[services.ports]]
    port = 8000
    handlers = ["http"]
    force_https = false  # Private network, no need for HTTPS

  [[services.checks]]
    grace_period = "10s"
    interval = "30s"
    method = "GET"
    timeout = "5s"
    path = "/live"

[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 512

[deploy]
  strategy = "immediate"
